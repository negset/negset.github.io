<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>share test</title>
</head>

<body>
  <div id="error"></div>
  <form method="POST" action="/share/">
    <table>
      <tr>
        <td><label for="shared_title">Title:</label></td>
        <td><input id="shared_title" name="shared_title" value="Example Title"></td>
      </tr>
      <tr>
        <td><label for="shared_text">Text:</label></td>
        <td><input id="shared_text" name="shared_text" value="Example text"></td>
      </tr>
      <tr>
        <td><label for="shared_url">URL:</label></td>
        <td><input id="shared_url" name="shared_url" value="https://example.com/a?b=c"></td>
      </tr>
      <tr>
        <td><label for="shared_file">File(s):</label></td>
        <td><input id="shared_file" name="shared_file" type="file" multiple></td>
      </tr>
    </table>
    <input type="submit" value="Share">
  </form>

  <script>
    'use strict';
    document.querySelector('form').onsubmit = () => {
      const error = document.getElementById('error');
      const title = "本日のスケジュール";
      const text = "本日のスケジュールはこちらです．";
      const url = "https://hakooshi.live";
      const files = document.getElementById('shared_file').files;
      const files2 = [ File("https://negset.com/favicon.png") ];

      let data = {};
      if (files2.length > 0) {
        data.files = files2;

        if (!navigator.canShare || !navigator.canShare(data)) {
    	    error.textContent = 'Share not attempted - file sharing is not supported by this browser';
    	    return false;
        }
      }
      if (title !== '')
        data.title = title;
      if (text !== '')
        data.text = text;
      if (url !== '')
        data.url = url;

      if (navigator.canShare && !navigator.canShare(data)) {
    	  error.textContent = 'Share not attempted - please supply title, text, url or files';
    	  return false;
      }
      error.textContent = '';
      navigator.share(data)
        .then(() => {})
        .catch((err) => {
        console.log('Unsuccessful share');
        error.textContent = 'Share failed: ' + err.message;
      });

      return false;
    };
  </script>
</body>

</html>
